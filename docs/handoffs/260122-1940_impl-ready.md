# Handoff: `vo` Implementation Ready

**Date:** 2026-01-22 19:40 PST
**Session:** Design completion for `vo` - context-aware VS Code file opener
**Next Agent Task:** Implement `vo` per design spec

---

## Your Mission

Build `vo` — a CLI + VS Code extension that opens files in the correct VS Code window based on git project context. The design is complete and approved. You're executing.

---

## Required Reading

**START HERE:**
- [`../DESIGN.md`](../DESIGN.md) — Complete design document with:
  - Problem statement and motivation
  - All 12 requirements + 4 nice-to-haves
  - Technical architecture (extension + CLI + registry)
  - Pseudo-code for both components
  - Edge cases and error handling
  - Implementation phases

This doc has everything. Read it fully before writing any code.

---

## Implementation Phases (from design)

| Phase | Scope | Deliverable |
|-------|-------|-------------|
| **1: MVP** | Extension skeleton, HTTP server, registry, basic CLI | `vo file.py` works on one platform |
| **2: Core** | Reveal in Explorer, zen mode, line numbers, WSL2 test | R1-R10 complete |
| **3: Polish** | Editor mappings, `--raw` flag, registry cleanup | R11-R12 complete |
| **4: N2H** | Directory support, auto-zen orphans, multi-file | Nice-to-haves |

**Recommendation:** Start with Phase 1. Get basic functionality working before adding features.

---

## Key Technical Decisions (Already Made)

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Project detection | Git root (`git rev-parse --show-toplevel`) | Reliable, standard |
| Window↔Workspace mapping | JSON registry at `~/.config/vo/registry.json` | Simple, portable |
| Extension↔CLI communication | HTTP on localhost (port 19800-19900) | Works in WSL, no IPC complexity |
| CLI implementation | Bash script (Phase 1) | Fast to prototype, rewrite later if needed |
| Default markdown editor | Mark Sharp (`msharp.customEditor`) | User's preferred WYSIWYG markdown |

---

## User Context (Critical)

- **Platforms:** WSL2 Ubuntu (primary) + macOS (laptop)
- **VS Code setup:** Uses Remote-WSL extension — extension host runs in WSL
- **ADHD:** Zen mode (`-z`) is important, not just a nice-to-have
- **Split panes:** Uses VS Code split editors, so don't hardcode editor placement
- **Primary use:** Documentation files (.md), occasionally code

---

## File Structure to Create

```
vo/
├── docs/
│   ├── DESIGN.md          # ✅ Already exists
│   └── handoffs/          # ✅ You're reading this
├── extension/
│   ├── package.json       # VS Code extension manifest
│   ├── tsconfig.json
│   └── src/
│       └── extension.ts   # Main extension code
├── cli/
│   └── vo                 # Bash script (make executable)
└── README.md              # User-facing docs
```

---

## CLI Dependencies

The bash script uses:
- `jq` — JSON parsing
- `curl` — HTTP requests
- `realpath` — Path resolution (coreutils)
- `git` — Project detection

Verify these are available on both WSL2 and macOS.

---

## Extension Skeleton

Start with VS Code extension generator:
```bash
npx yo code
```

Key `package.json` fields:
```json
{
  "activationEvents": ["onStartupFinished"],
  "contributes": {},
  "main": "./out/extension.js"
}
```

The extension should activate on any folder open (not a specific file type).

---

## Testing Strategy

1. **Manual first:** Get basic flow working
2. **Two windows test:** Open two projects in VS Code, verify correct targeting
3. **WSL2 test:** Verify Remote-WSL compatibility (this is the trickier platform)
4. **Edge cases:** Stale registry, crashed VS Code, no git root

---

## Known Gotchas

| Issue | Mitigation |
|-------|------------|
| Registry file locking | Use atomic writes (write to temp, rename) |
| Stale entries | Health check (`/health` endpoint) before sending open request |
| Port conflicts | Scan range 19800-19900, pick first available |
| VS Code window focus | May need platform-specific handling beyond `focusActiveEditorGroup` |

---

## Questions to Ask User If Needed

1. **Extension naming:** What should the extension be called? (`vo-server`? `vscode-opener`?)
2. **Distribution:** Start with local .vsix install or set up marketplace publishing?
3. **Testing priority:** Focus on WSL2 first (primary) or macOS first (simpler)?

---

## Success Criteria

Phase 1 is complete when:
- [ ] VS Code extension activates and registers in `~/.config/vo/registry.json`
- [ ] Extension starts HTTP server on localhost, responds to `/health` and `/open`
- [ ] CLI reads registry, finds matching port, sends request
- [ ] File opens in correct VS Code window

Good luck. The design is solid — trust it.
